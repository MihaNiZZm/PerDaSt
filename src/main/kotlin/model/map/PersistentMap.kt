package com.github.mihanizzm.model.map

/**
 * Персистентное отображение (ключ → значение).
 *
 * Общие принципы:
 * - Все «изменяющие» операции возвращают новую версию; исходная не изменяется.
 * - Ключи должны быть сравнимы (см. ограничение типа `K : Comparable<K>`).
 * - Контракт интерфейса не навязывает порядок обхода ключей; конкретная реализация
 *   может добавлять дополнительные гарантии (например, упорядоченность).
 */
interface PersistentMap<K: Comparable<K>, V> {
    /**
     * Количество пар (key, value) в отображении.
     */
    val size: Int

    /**
     * Возвращает значение по ключу [key] или `null`, если ключ отсутствует.
     *
     * Сложность доступа определяется реализацией (в AVL-реализации — O(log n)).
     */
    operator fun get(key: K): V?

    /**
     * Возвращает новую версию мапы с добавленной или обновлённой парой [key] → [value].
     *
     * Если ключ уже присутствовал, его значение переопределяется.
     * Исходная версия не изменяется.
     */
    fun put(key: K, value: V): PersistentMap<K, V>

    /**
     * Возвращает новую версию мапы без пары с ключом [key].
     *
     * Если ключ отсутствовал, возвращается эквивалент исходной версии.
     * Исходная версия не изменяется.
     */
    fun remove(key: K): PersistentMap<K, V>

    /**
     * Проверяет наличие ключа [key] (эквивалентно `get(key) != null`).
     */
    operator fun contains(key: K): Boolean = get(key) != null

    /**
     * Возвращает множество ключей, присутствующих в мапе.
     *
     * Порядок элементов множества не гарантируется контрактом интерфейса.
     */
    fun keys(): Set<K>
}